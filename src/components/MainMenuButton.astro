---
import { Icon } from "astro-icon/components";

interface Props {
	visible?: boolean;
}

const { visible } = Astro.props;
---

<mobile-button
	aria-expanded="false"
	aria-haspopup="menu"
	aria-role="button"
	aria-label="Open main menu"
	class="group relative h-8 w-8 rounded-lg bg-color-100 text-accent-base hover:bg-accent-base/10"
	class:list={{ "md:invisible md:hidden": !visible }}
	id="toggle-nav-menu-mobile"
	type="button"
>
	<Icon
		id="open-nav-menu-icon"
		aria-hidden="true"
		class="absolute start-1/2 top-1/2 h-6 w-6 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all"
		focusable="false"
		name="ei:navicon"
	/>
	<Icon
		id="close-nav-menu-icon"
		aria-hidden="true"
		class="absolute start-1/2 top-1/2 h-6 w-6 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all"
		focusable="false"
		name="ei:close"
	/>
</mobile-button>

<script>
	document.addEventListener("DOMContentLoaded", () => {
		const toggleNavMenuMobileButton = document.getElementById("toggle-nav-menu-mobile");
		const toggleNavMenuButtons = document.querySelectorAll("[data-toggle-nav-menu]");
		const openMenuIcon = document.getElementById("open-nav-menu-icon");
		const closeMenuIcon = document.getElementById("close-nav-menu-icon");
		const drawer = document.getElementById("drawer");

		//
		if (!toggleNavMenuMobileButton || !openMenuIcon || !closeMenuIcon || !drawer) {
			console.error("One or more required elements are missing in the DOM.");
			return;
		}

		const drawerBody = document.getElementById("drawer-body");
		if (!drawerBody) {
			console.error("Drawer body element is missing in the DOM.");
			return;
		}

		for (const e of [toggleNavMenuMobileButton, ...toggleNavMenuButtons]) {
			e.addEventListener("click", () => {
				const isOpen = toggleNavMenuMobileButton.getAttribute("aria-expanded") === "true";

				if (isOpen) {
					//
					drawerBody.classList.add("opacity-0", "-translate-y-full");
					drawerBody.classList.remove("translate-y-0");

					//
					setTimeout(() => {
						drawer.classList.add("hidden");
					}, 300);

					//
					openMenuIcon.classList.add("scale-100", "opacity-100");
					closeMenuIcon.classList.add("scale-0", "opacity-0");
					closeMenuIcon.classList.remove("scale-100", "opacity-100");
				} else {
					//
					drawer.classList.remove("hidden");
					drawerBody.classList.add("translate-y-0");
					drawerBody.classList.remove("opacity-0", "-translate-y-full");

					//
					openMenuIcon.classList.add("scale-0", "opacity-0");
					closeMenuIcon.classList.add("scale-100", "opacity-100");
					openMenuIcon.classList.remove("scale-100", "opacity-100");
				}

				//
				toggleNavMenuMobileButton.setAttribute("aria-expanded", (!isOpen).toString());
			});
		}
	});
</script>
